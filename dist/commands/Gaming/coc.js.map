{"version":3,"file":"coc.js","sourceRoot":"","sources":["../../../src/commands/Gaming/coc.ts"],"names":[],"mappings":"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","sourcesContent":["import { Command, Args } from \"@sapphire/framework\";\nimport { Message, MessageEmbed, User } from \"discord.js\";\nimport { fetch } from \"@utils/util\";\nimport { API_KEYS } from \"@root/config\";\nimport { DbSet } from \"@lib/structures/DbSet\";\nimport { toTitleCase } from \"@sapphire/utilities\";\n\nexport class PenguCommand extends Command {\n\n    public async run(message: Message, args: Args) {\n        let username: string|undefined|null = await args.pick(\"string\").catch(() => null);\n        if (!username) username = await this.fetchGametag(message.author);\n        if (!username) return message.sendTranslated(\"commands/gaming:noGamerTag\");\n\n        const res: ClashOfClansRes = await fetch(`https://api.clashofclans.com/v1/players/${encodeURIComponent(username.toUpperCase())}`, { headers: { Authorization: API_KEYS.COC } });\n        if (!res) return message.sendTranslated(\"commands/gaming:notFound\");\n\n        // @todo save flag to save account tag\n\n        const embed = new MessageEmbed()\n            .setFooter(`PenguBot.com`)\n            .setTimestamp()\n            .setThumbnail(`https://coc.guide/static/imgs/other/town-hall-${res.townHallLevel}.png`)\n            .setColor(\"#FCCF6E\")\n            .setAuthor(`${res.name} ${res.league ? `| ${res.league.name}` : \"\"}`, res.league ? res.league.iconUrls.small : \"\", \"https://pengubot.com\")\n            .addField(await message.fetchLanguageKey(\"commands/gaming:coc.trophies\"), res.trophies.toLocaleString(), true)\n            .addField(await message.fetchLanguageKey(\"commands/gaming:coc.warStars\"), res.warStars.toLocaleString(), true)\n            .addField(await message.fetchLanguageKey(\"commands/gaming:coc.bestTrophies\"), res.bestTrophies.toLocaleString(), true);\n\n        if (res.clan) embed.setFooter(`PenguBot.com | ${toTitleCase(res.role)} - ${res.clan.name}\\u200e ${res.clan.tag}`, res.clan.badgeUrls.small);\n\n        let troopLevels = \"\";\n        let spellLevels = \"\";\n        let heroLevels = \"\";\n\n        for (const troop of res.troops) troopLevels += `${troop.name}: ${troop.level} ${troop.level === troop.maxLevel ? \"ðŸ”¥\\n\" : \"\\n\"}`;\n        if (res.spells) for (const spell of res.spells) spellLevels += `${spell.name}: ${spell.level} ${spell.level === spell.maxLevel ? \"ðŸ”¥\\n\" : \"\\n\"}`;\n        if (res.heroes) for (const hero of res.heroes) heroLevels += `${hero.name}: ${hero.level} ${hero.level === hero.maxLevel ? \"ðŸ”¥\\n\" : \"\\n\"}`;\n\n        if (troopLevels) embed.addField(await message.fetchLanguageKey(\"commands/gaming:coc.troopLevels\"), troopLevels, true);\n        if (spellLevels) embed.addField(await message.fetchLanguageKey(\"commands/gaming:coc.spellLevels\"), spellLevels, true);\n        if (heroLevels) embed.addField(await message.fetchLanguageKey(\"commands/gaming:coc.heroLevels\"), heroLevels, true);\n\n        return message.channel.send({ embed });\n    }\n\n    public async fetchGametag(author: User) {\n        const { users } = await DbSet.connect();\n        const gametagData = await users.fetchGametag<ClashOfClansGametagData>(this.name, author);\n\n        return gametagData.data?.tag;\n    }\n\n}\n\ninterface ClashOfClansGametagData {\n    tag?: string;\n}\n\ninterface ClashOfClansRes {\n    clan?: {\n        tag: string,\n        clanLevel: number,\n        name: string,\n        badgeUrls: {\n            small: string,\n            large: string,\n            medium: string\n        }\n    },\n    league?: {\n        name: string,\n        id: number,\n        iconUrls: {\n            small: string,\n            large: string,\n            medium: string\n        }\n    },\n    role: string,\n    attackWins: number,\n    defenseWins: number,\n    townHallLevel: number,\n    townHallWeaponLevel: number,\n    versusBattleWins: number,\n    legendStatistics: {\n        legendTrophies: number,\n        currentSeason: {\n            trophies: number,\n            id: string,\n            rank: number\n        },\n        bestSeason: {\n            trophies: number,\n            id: string,\n            rank: number\n        },\n        previousSeason: {\n            trophies: number,\n            id: string,\n            rank: number\n        },\n        previousVersusSeason: {\n            trophies: number,\n            id: string,\n            rank: number\n        },\n        bestVersusSeason: {\n            trophies: number,\n            id: string,\n            rank: number\n        }\n    },\n    troops: [\n        {\n            level: number,\n            name: string,\n            maxLevel: number,\n            village: string\n        }\n    ],\n    heroes?: [\n        {\n            level: number,\n            name: string,\n            maxLevel: number,\n            village: string\n        }\n    ],\n    spells?: [\n        {\n            level: number,\n            name: string,\n            maxLevel: number,\n            village: string\n        }\n    ],\n    labels?: [\n        {\n            name: string,\n            id: number,\n            iconUrls: {\n                small: string,\n                large: string,\n                medium: string\n            }\n        }\n    ],\n    tag: string,\n    name: string,\n    expLevel: number,\n    trophies: number,\n    bestTrophies: number,\n    donations: number,\n    donationsReceived: number,\n    builderHallLevel: number,\n    versusTrophies: number,\n    bestVersusTrophies: number,\n    warStars: number,\n    achievements: [\n        {\n            stars: number,\n            value: number,\n            name: string,\n            target: number,\n            info: string,\n            completionInfo: string,\n            village: string\n        }\n    ],\n    versusBattleWinCount: number\n}\n"]}